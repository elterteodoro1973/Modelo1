@using Modelo.Web.ViewModels.Usuarios;
@model CadastrarEditarUsuarioViewModel
@{
    TempData["Title"] = "Cadastrar Usuário";
}

<h1 class="o-title"> CADASTRAR USUÁRIO </h1>
<partial name="~/Views/Shared/_Avisos.cshtml" />
<form asp-action="Adicionar" method="post" class="c-form">
    <div class="c-form__section">
        <span class="c-form__section--label">Dados gerais</span>
        <div class="row">
            <div class="c-form__group col-8">
                <label asp-for="Nome" class="c-form__label form-label control-label"></label>
                <input asp-for="Nome" class="c-form__input form-control" required placeholder="Nome Completo">
                <span asp-validation-for="Nome" class="form-text text-danger"></span>
            </div>
            <div class="c-form__group col-4">
                <label asp-for="CPF" class="c-form__label form-label control-label"></label>
                <input asp-for="CPF" data-mask="000.000.000-00" data-mask-reverse="true" data-rule-cpf="true" required class="c-form__input form-control maskCPF">
                <span asp-validation-for="CPF" class="form-text text-danger"></span>
            </div>
        </div>

    </div>


    <div class="row">
        <div class="c-form__group col-12">
            <label asp-for="Email" class="c-form__label form-label control-label"></label>
            <input asp-for="Email" class="c-form__input form-control" required placeholder="Email" value="@Model.Email">
            <span asp-validation-for="Nome" class="form-text text-danger"></span>
        </div>
    </div>



    <div class="c-form__btn-group">
        <input type="submit" value="Cadastrar Usuário" class="o-btn o-btn-default">
        <input type="button" value="Cancelar" class="o-btn o-btn-alt" onclick="paginaInicial()">
    </div>
</form>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script src="~/js/usuario.js"></script>
   
    <script>

        function paginaInicial() {
            window.location.href = "@Url.Action("Index","Usuarios")";
        }

        const modal = new bootstrap.Modal('#modalConfirmacao');
        
        $("form").submit((e) => {
            e.preventDefault();
            $(".checkboxCBH").each((i, element) => {

                $(element).remove();

            })

            if ($("form").valid()) {
                let indexInicio = 0;
                $("input[name=CBHs][type=checkbox]").each((i, element) => {
                    if ($(element).is(":checked")) {
                        let valor = $(element).val();
                        $("<input>").attr("type", "hidden").attr("name", `CBHs[${indexInicio}]`).addClass("checkboxCBH").val(valor).appendTo($("form"));
                        indexInicio++;
                    }
                });

                $(".modal-body").html("<p class='lh-base'>Deseja confirmar o cadastro do novo usuário?</p>")

                modal.show();

                $("#btnConfirmarModal").on("click", (element) => {
                    modal.hide();
                    e.currentTarget.submit();
                })

            }
        });

        $(document).ready(() => {
            $("input[name=CBHs][type=checkbox]:checked").each((i, e) => {
                let valor = $(e).val();
                $("<input>").attr("type", "hidden").attr("name", `CBHs[${i}]`).addClass("checkboxCBH").val(valor).appendTo($("form"));
            })
        })
    </script>
    }